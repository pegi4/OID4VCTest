import { ValidationBundler } from './validationBundler';
export class SubmissionRequirementVB extends ValidationBundler {
    ruleIsMandatoryMsg = 'rule is a mandatory field';
    needsOneFromOrFromNestedMsg = 'needs exactly one of from or from_nested';
    fromNestedShouldBeArrayMsg = 'The value of the from_nested property MUST be an array';
    isCountPositiveIntMsg = 'count must be a practical positive number';
    isMinPositiveIntMsg = 'min must be a practical positive number';
    isMaxPositiveIntMsg = 'max must be a practical positive number';
    ruleShouldBePickOrAllMsg = 'rule should be either pick or all';
    constructor(parentTag) {
        super(parentTag, 'submission_requirements');
    }
    getValidations(srs) {
        let validations = [];
        if (srs != null && srs.length > 0) {
            for (let srInd = 0; srInd < srs.length; srInd++) {
                validations = [...validations, ...this.getMyValidations(srInd, srs), ...this.getSubValidations(srInd, srs)];
            }
        }
        return validations;
    }
    getMyValidations(srInd, srs) {
        return [
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: SubmissionRequirementVB.ruleIsMandatory,
                message: this.ruleIsMandatoryMsg,
            },
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: SubmissionRequirementVB.needsOneFromOrFromNested,
                message: this.needsOneFromOrFromNestedMsg,
            },
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: SubmissionRequirementVB.fromNestedShouldBeArray,
                message: this.fromNestedShouldBeArrayMsg,
            },
            // TODO Validation 4.2.1.E All objects in from_nested should be of type SubmissionRequirement
            //      See if it can be implemented in pe-api yamls. currently in typescript type of this variable is 'any'
            //      i.e. from_nested?: Array<object>;
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: this.isCountPositiveInt,
                message: this.isCountPositiveIntMsg,
            },
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: this.isMinPositiveInt,
                message: this.isMinPositiveIntMsg,
            },
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: this.isMaxPositiveInt,
                message: this.isMaxPositiveIntMsg,
            },
            {
                tag: this.getMyTag(srInd),
                target: srs[srInd],
                predicate: SubmissionRequirementVB.ruleShouldBePickOrAll,
                message: this.ruleShouldBePickOrAllMsg,
            }, // Validation 4.2.4
        ];
    }
    getMyTag(srInd) {
        // TODO extract to make it generic
        return this.parentTag + '.' + this.myTag + '[' + srInd + ']';
    }
    getSubValidations(srInd, srs) {
        const fromNested = srs[srInd].from_nested;
        return fromNested != null ? new SubmissionRequirementVB(this.getFromNestedTag(srInd)).getValidations(fromNested) : [];
    }
    getFromNestedTag(srInd) {
        return this.getMyTag(srInd) + '.' + 'from_nested';
    }
    isCountPositiveInt(sr) {
        return sr.rule !== 'pick' || sr.count == null || 0 < sr.count;
    }
    isMinPositiveInt(sr) {
        return sr.rule !== 'pick' || sr.min == null || 0 <= sr.min;
    }
    isMaxPositiveInt(sr) {
        return sr.rule !== 'pick' || sr.max == null || 0 < sr.max;
    }
    static ruleIsMandatory(sr) {
        return sr.rule != null;
    }
    static needsOneFromOrFromNested(sr) {
        return (sr.from == null) !== (sr.from_nested == null); // XOR
    }
    static fromNestedShouldBeArray(sr) {
        return sr.from_nested == null || Array.isArray(sr.from_nested);
    }
    static ruleShouldBePickOrAll(sr) {
        return sr.rule === 'pick' || sr.rule === 'all';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3VibWlzc2lvblJlcXVpcmVtZW50VkIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWIvdmFsaWRhdGlvbi9idW5kbGVycy9zdWJtaXNzaW9uUmVxdWlyZW1lbnRWQi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV4RCxNQUFNLE9BQU8sdUJBQXdCLFNBQVEsaUJBQXdDO0lBQ2xFLGtCQUFrQixHQUFHLDJCQUEyQixDQUFDO0lBQ2pELDJCQUEyQixHQUFHLDBDQUEwQyxDQUFDO0lBQ3pFLDBCQUEwQixHQUFHLHdEQUF3RCxDQUFDO0lBQ3RGLHFCQUFxQixHQUFHLDJDQUEyQyxDQUFDO0lBQ3BFLG1CQUFtQixHQUFHLHlDQUF5QyxDQUFDO0lBQ2hFLG1CQUFtQixHQUFHLHlDQUF5QyxDQUFDO0lBQ2hFLHdCQUF3QixHQUFHLG1DQUFtQyxDQUFDO0lBRWhGLFlBQVksU0FBaUI7UUFDM0IsS0FBSyxDQUFDLFNBQVMsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFTSxjQUFjLENBQUMsR0FBNEI7UUFDaEQsSUFBSSxXQUFXLEdBQXdDLEVBQUUsQ0FBQztRQUMxRCxJQUFJLEdBQUcsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakMsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUU7Z0JBQy9DLFdBQVcsR0FBRyxDQUFDLEdBQUcsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQzthQUM3RztTQUNGO1FBQ0QsT0FBTyxXQUFXLENBQUM7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